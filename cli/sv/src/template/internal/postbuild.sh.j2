set -e

export SERVICE_NAME="{{ service_name }}"
export ENVIRONMENT="{{ environment }}"
export BUILD_DIRECTORY="{{ build_directory }}"

source "{{ svctl_directory }}/sv/app/.helper/common"
source "{{ service_definition_script }}"

touch "$BUILD_DIRECTORY/.postbuild"

if type -t postbuild > /dev/null; then
  pushd "$BUILD_DIRECTORY"
  postbuild "$SERVICE_NAME" "$ENVIRONMENT" "$BUILD_DIRECTORY"
  popd
else
  logger_warn "Post build script for ${COLOR_YELLOW}$SERVICE_NAME${COLOR_NORMAL} is not defined"
fi
